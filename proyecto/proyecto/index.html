
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>Proyecto de la asignatura de interfaces de usuario, parte de iOS básico - IUDM-iOS-basico</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proyecto-de-la-asignatura-de-interfaces-de-usuario-parte-de-ios-basico" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="IUDM-iOS-basico" class="md-header__button md-logo" aria-label="IUDM-iOS-basico" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IUDM-iOS-basico
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Proyecto de la asignatura de interfaces de usuario, parte de iOS básico
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="IUDM-iOS-basico" class="md-nav__button md-logo" aria-label="IUDM-iOS-basico" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    IUDM-iOS-basico
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../2_vistas/apuntes/" class="md-nav__link">
        Vistas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../2_vistas/ejercicios/" class="md-nav__link">
        Ejercicios sobre vistas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../1_controllers/apuntes/" class="md-nav__link">
        Controllers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../1_controllers/ejercicios/" class="md-nav__link">
        Ejercicios de controllers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../4_tablas/apuntes/" class="md-nav__link">
        Tablas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../4_tablas/ejercicios/" class="md-nav__link">
        Ejercicios de tablas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../3_autolayout/apuntes/" class="md-nav__link">
        Autolayout
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../3_autolayout/ejercicios/" class="md-nav__link">
        Ejercicios de autolayout
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pasos-iniciales" class="md-nav__link">
    Pasos iniciales
  </a>
  
    <nav class="md-nav" aria-label="Pasos iniciales">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registro-en-la-api-de-marvel" class="md-nav__link">
    Registro en la API de Marvel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceso-a-la-api" class="md-nav__link">
    Acceso a la API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uso-de-la-plantilla-de-proyecto" class="md-nav__link">
    Uso de la plantilla de proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-que-debe-tener-la-aplicacion" class="md-nav__link">
    Estructura que debe tener la aplicación
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pantalla-inicial" class="md-nav__link">
    Pantalla inicial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-maestro-2-puntos" class="md-nav__link">
    Vista maestro (2 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Vista maestro (2 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-los-componentes-de-la-interfaz" class="md-nav__link">
    Crear los componentes de la interfaz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gestionar-la-barra-de-busqueda" class="md-nav__link">
    Gestionar la barra de búsqueda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mostrar-los-resultados-en-la-tabla" class="md-nav__link">
    Mostrar los resultados en la tabla
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-de-detalle-15-puntos" class="md-nav__link">
    Vista de detalle (1,5 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Vista de detalle (1,5 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-navigation-controller" class="md-nav__link">
    El navigation controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#la-pantalla-de-detalles-del-item" class="md-nav__link">
    La pantalla de detalles del item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-la-interfaz-y-conexion-con-la-pantalla-anterior" class="md-nav__link">
    Creación de la interfaz y conexión con la pantalla anterior
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion-de-la-funcionalidad" class="md-nav__link">
    Implementación de la funcionalidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imagen-a-tamano-completo-1-punto" class="md-nav__link">
    Imagen a tamaño completo (1 punto)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-acerca-de-025-puntos" class="md-nav__link">
    Vista "Acerca de" (0,25 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero" class="md-nav__link">
    Apéndice: creación de la plantilla de proyecto desde cero
  </a>
  
    <nav class="md-nav" aria-label="Apéndice: creación de la plantilla de proyecto desde cero">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uso-de-marvelous" class="md-nav__link">
    Uso de Marvelous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="proyecto-de-la-asignatura-de-interfaces-de-usuario-parte-de-ios-basico">Proyecto de la asignatura de interfaces de usuario, parte de iOS básico<a class="headerlink" href="#proyecto-de-la-asignatura-de-interfaces-de-usuario-parte-de-ios-basico" title="Permanent link">&para;</a></h1>
<p>Este "miniproyecto" trata de hacer una pequeña aplicación basándose en <a href="https://developer.marvel.com/">el API</a> de la editorial Marvel, que nos permite consultar información sobre los personajes, los <em>comics</em>, las <em>series</em>,...</p>
<h2 id="pasos-iniciales">Pasos iniciales<a class="headerlink" href="#pasos-iniciales" title="Permanent link">&para;</a></h2>
<h3 id="registro-en-la-api-de-marvel">Registro en la API de Marvel<a class="headerlink" href="#registro-en-la-api-de-marvel" title="Permanent link">&para;</a></h3>
<p>Para poder usar la API de Marvel hacen falta claves de desarrollador. La plantilla de proyecto disponible en la web ya tiene unas incorporadas. Con esas claves se pueden hacer 3000 peticiones diarias al API, probablemente suficientes para su uso en clase. No obstante también puedes registrarte desde el <a href="https://developer.marvel.com/">portal de desarrolladores</a> de Marvel para poder obtener claves propias. </p>
<h3 id="acceso-a-la-api">Acceso a la API<a class="headerlink" href="#acceso-a-la-api" title="Permanent link">&para;</a></h3>
<p>La API de Marvel es REST, por lo que acepta peticiones HTTP. No obstante hacerlas directamente con los APIs de iOS sería un poco engorroso, por lo que vamos a usar un par de librerías que nos faciliten no solo hacer la petición en sí sino sobre todo <em>parsear</em> el JSON. Usaremos una librería adicional llamada Marvelous, que encapsula las llamadas al API en una serie de clases de modo que no tenemos que hacer peticiones HTTP directamente. </p>
<blockquote>
<p><strong>IMPORTANTE</strong>: para acelerar el trabajo en el aula tenéis disponible en moodle la plantilla de <em>workspace</em> ya creada. </p>
</blockquote>
<h2 id="uso-de-la-plantilla-de-proyecto">Uso de la plantilla de proyecto<a class="headerlink" href="#uso-de-la-plantilla-de-proyecto" title="Permanent link">&para;</a></h2>
<p>En la plantilla de workspace descargada <strong>abre el fichero Marvel.xcworkspace</strong>, que es un <em>workspace</em> de Xcode (un conjunto de proyectos), no el proyecto Marvel directamente (<strong>NO ABRAS DIRECTAMENTE el <code>Marvel.xcodeproj</code></strong>). Si lo has abierto correctamente, deberías ver dos proyectos, uno llamado <code>Marvel</code>, y otro llamado <code>Pods</code>. El proyecto principal es el primero, el segundo son librerías auxiliares. </p>
<blockquote>
<p>Si quieres ver más información sobre la estructura del proyecto, o cómo crearlo partiendo de cero, puedes verlo en el <a href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero">Apéndice</a></p>
</blockquote>
<p><strong>Primero hay que hacer un <code>Product &gt; Clean Build Folder</code>, y <code>Product &gt; Build</code></strong> para asegurarse de que las dependencias están compiladas y accesibles en nuestro código. Una vez hecho esto podemos ejecutar la app, en la consola aparecerá una lista de personajes cuyo nombre empieza por "Spider". Puedes mirar el código del View Controller para ver cómo se ha hecho.</p>
<p>Una vez hecho el <em>build</em>, puedes comprobar si la conexión con el API funciona bien ejecutando la aplicación, no verás nada en la pantalla del simulador pero en la consola de Xcode debería aparecer una lista de personajes que comienzan por "spider". Puedes examinar el código del view controller para ver cómo se ha hecho, usamos una librería auxiliar llamada <code>Marvelous</code> que implementa el acceso al API de forma sencilla.</p>
<h2 id="estructura-que-debe-tener-la-aplicacion">Estructura que debe tener la aplicación<a class="headerlink" href="#estructura-que-debe-tener-la-aplicacion" title="Permanent link">&para;</a></h2>
<p>Para que te hagas una idea de la estructura, se muestra el <em>storyboard</em> de la aplicación ya terminada</p>
<p><img alt="" src="../images/storyboard.png" /></p>
<p>En la aplicación se podrá buscar, listar y mostrar los detalles de alguno de los recursos que ofrece el API. Elige tú lo que prefieras: personajes, comics, creadores... </p>
<h2 id="pantalla-inicial">Pantalla inicial<a class="headerlink" href="#pantalla-inicial" title="Permanent link">&para;</a></h2>
<p>Puedes comenzar creando un <em>tab bar</em> a partir de la pantalla inicial: selecciónala y en el menú <code>Editor</code> elige <code>Embed In &gt; Tab Bar Controller</code>.</p>
<h2 id="vista-maestro-2-puntos">Vista maestro (2 puntos)<a class="headerlink" href="#vista-maestro-2-puntos" title="Permanent link">&para;</a></h2>
<p>Esta debe ser una pantalla con una barra de búsqueda y una vista de tabla en la que se puede buscar y listar el recurso elegido (por ejemplo personajes). El resultado final será algo como:</p>
<p><img alt="" src="../images/maestro.png" /></p>
<p>Ve a la primera (y por el momento única) pantalla de contenido del <em>tab bar</em>, selecciona la barra inferior y en las propiedades <code>bar item</code> ponle un título apropiado (por ejemplo "Personajes") y un icono relevante.</p>
<blockquote>
<p>Recuerda que tienes unas cuantas webs de donde puedes coger iconos "planos", por ejemplo <a href="https://www.iconfinder.com/iconsets/ios-7-icons">https://www.iconfinder.com/iconsets/ios-7-icons</a> o <a href="http://www.flaticon.com/packs/line-icon-set">http://www.flaticon.com/packs/line-icon-set</a></p>
</blockquote>
<h3 id="crear-los-componentes-de-la-interfaz">Crear los componentes de la interfaz<a class="headerlink" href="#crear-los-componentes-de-la-interfaz" title="Permanent link">&para;</a></h3>
<p>La tabla:</p>
<ul>
<li>Arrastra una <em>table view</em> a la pantalla de "personajes" (o "comics", o lo que hayas elegido)</li>
<li>Selecciona la tabla y en las propiedades crea un prototipo de celda incrementando el <code>Prototype cells</code> a 1.</li>
<li>Selecciona el prototipo de celda recién creado (el <code>table view cell</code>) y en las propiedades elige como <code>style</code> el valor <code>Basic</code>, para poder usar uno de los tipos predefinidos de celda y no tener que hacerlo tú.</li>
</ul>
<p>La barra de búsqueda:</p>
<ul>
<li>Arrastra un componente de tipo <em>search bar</em> a la pantalla y déjalo justo arriba de la tabla.</li>
</ul>
<p>Nos falta fijar el <em>autolayout</em>:</p>
<ul>
<li>Selecciona barra y tabla manteniendo pulsada la tecla <code>Cmd</code> e inserta ambas en un <em>stack view</em> utilizando el primero de los botones de <em>autolayout</em> (parte inferior derecha del *storyboard)</li>
<li>Haz que este <em>stack view</em> ocupe toda la pantalla. Lo más sencillo es ponerle 4 restricciones de distancia 0 a los bordes.</li>
</ul>
<p>Una vez hecho esto puedes poner en marcha la <em>app</em> para ver si la interfaz tiene buen aspecto. La tabla aparecerá vacía, por supuesto.</p>
<h3 id="gestionar-la-barra-de-busqueda">Gestionar la barra de búsqueda<a class="headerlink" href="#gestionar-la-barra-de-busqueda" title="Permanent link">&para;</a></h3>
<p>La barra de búsqueda utiliza el patrón <em>delegación</em> para gestionar los eventos de escribir en ella, pulsar "buscar" en el teclado, etc.</p>
<p>El objeto que actúe como <em>delegate</em> de la barra de búsqueda debe implementar el protocolo <code>UISearchBarDelegate</code>. Puede ser cualquiera, aunque siguiendo la filosofía MVC (Monster View Controller) haremos que sea el <em>view controller</em> de la pantalla actual :).</p>
<p>Vamos a crear este <em>view controller</em>: </p>
<ul>
<li>Crea una nueva clase de Cocoa Touch llamada <code>ListaController</code> y haz que sea una subclase de <code>UIViewController</code></li>
<li>Asígnale ese <em>controller</em> a la pantalla de lista que has creado antes. Recuerda que esto se hace a través del <code>identity inspector</code>.</li>
</ul>
<p>Ahora vamos a conectar el <em>view controller</em> con la barra de búsqueda:</p>
<ul>
<li>Selecciona la <em>search bar</em> (te será más fácil si lo haces en el árbol de componentes) y en el <code>connections inspector</code> (panel de la derecha de Xcode, icono de más a la derecha) conecta el <em>outlet</em> <code>delegate</code> con el <em>controller</em> de esta pantalla. Recuerda que el <em>controller</em> está representado gráficamente con un icono de color amarillo que aparece en la parte superior de cada pantalla de la <em>app</em> en el <em>storyboard</em>.</li>
</ul>
<p><img alt="" src="../images/connect_delegate.gif" /></p>
<blockquote>
<p>Si has hecho esto ya no es necesario que establezcas la conexión por código, asignando la propiedad <code>delegate</code> de la barra de búsqueda al <em>controller</em></p>
</blockquote>
<ul>
<li>Pon en la cabecera <code>ListaController</code> que esta clase implementa el protocolo <code>UISearchBarDelegate</code></li>
<li>En el <code>ListaController</code> implementa el método <code>searchBarSearchButtonClicked(_)</code>, que se llamará cuando se escriba algo en la barra y se pulse el botón del teclado "buscar". Para probar que funciona de momento basta que imprimas en la consola el texto escrito en la barra y quites el teclado <em>on screen</em>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">searchBarSearchButtonClicked</span><span class="p">(</span><span class="kc">_</span> <span class="n">searchBar</span><span class="p">:</span> <span class="bp">UISearchBar</span><span class="p">)</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Buscado: </span><span class="si">\(</span><span class="n">searchBar</span><span class="p">.</span><span class="n">text</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">searchBar</span><span class="p">.</span><span class="n">resignFirstResponder</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Ejecuta la <em>app</em> y comprueba que efectivamente funciona.</p>
<p>Ahora <strong>tendrás que poner código propio</strong> para que cuando se pulse en el botón de buscar se haga la llamada a la API de Marvel. Por el momento lo más simple es mostrar los resultados con <code>print</code>. Puedes asignárselos también a un array que sea una propiedad del <em>controller</em>, para que luego sean sencillos de mostrar en la tabla.</p>
<h3 id="mostrar-los-resultados-en-la-tabla">Mostrar los resultados en la tabla<a class="headerlink" href="#mostrar-los-resultados-en-la-tabla" title="Permanent link">&para;</a></h3>
<p>Una vez conseguido esto, tendrás que hacer que los resultados aparezcan en la tabla. Recuerda que necesitas un <em>datasource</em> para ella, y que para simplificar puedes hacer que sea el <code>ListaController</code>. A grandes rasgos esto implica:</p>
<ul>
<li>Que, como decíamos antes, el <em>controller</em> debe tener acceso a los datos, por ejemplo guardándolos en una propiedad que sea un array.</li>
<li>Que tienes que conectar en el <code>connections inspector</code> el <em>outlet</em> <code>datasource</code> con el <em>controller</em>.</li>
<li>Que el <code>ListaController</code> debe implementar el protocolo <code>UITableViewDataSource</code>. Hay que poner en la cabecera que esto es así, y además implementar los correspondientes métodos en el código del <em>controller</em>, uno para devolver el número de filas en la tabla y otro para devolver una celda dado su <code>indexPath</code>.</li>
</ul>
<p>Cada vez que se haga una búsqueda y se añadan datos al array tendrás que decirle a iOS que vuelva a redibujar la tabla llamando a su método <code>reloadData</code>. Cuidado, porque al ser una actualización de la interfaz debes asegurarte de que esto lo estás haciendo desde el <em>thread</em> principal, algo como:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//sustituye self.vistaTabla por el outlet que hayas definido</span>
<span class="c1">//para acceder a la tabla desde el controlador</span>
<span class="n">OperationQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">addOperation</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">vistaTabla</span><span class="p">.</span><span class="n">reloadData</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Obtener la cola principal de operaciones explícitamente es necesario si, como es lo más lógico, colocas el código anterior en el bloque que obtiene la respuesta del API de Marvel. Recuerda que para evitar bloqueos, Marvelous funciona de modo asíncrono en un <em>thread</em> distinto al principal</p>
</blockquote>
<p>Una vez terminado todo esto, esta pantalla debería ser casi totalmente funcional. Solo quedaría ver los detalles de cada <em>item</em> al hacer <em>tap</em> sobre él.</p>
<p>Opcionalmente <strong>(0,25 puntos extra)</strong>, puedes hacer que aparezca un <em>spinner</em> mientras se está procesando la petición, para que el usuario sepa que el sistema está esperando datos. Los <em>spinners</em> en iOS se denominan <em>Activity Indicators</em>. Puedes consultar la referencia de la <a href="https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIActivityIndicatorView_Class/index.html">clase <code>UIActivityIndicator</code></a> para ver la forma de uso, aunque es muy sencillo, básicamente debes hacer <code>startAnimating</code> para que empiece a girar y <code>stopAnimating</code> para pararlo. </p>
<blockquote>
<p>Es posible que el <em>activity indicator</em> se te quede detrás de los otros elementos de interfaz y no se vea. Puedes usar el método <code>bringSubviewToFront</code> que se llama desde la vista "madre" para pasar a una vista "hija" a "primer plano". Si estamos en el <em>controller</em> sería algo como <code>self.view bringSubview(toFront:self.miActivityIndicator)</code>, ya que recuerda que <code>self.view</code>en un <em>controller</em> es la vista principal. Tendrás que sustituir la referencia <code>self.miActivityIndicator</code> por la apropiada en tu caso. Además de esto lleva cuidado también con el color, otro problema típico es usar uno del mismo color que el fondo.</p>
</blockquote>
<h2 id="vista-de-detalle-15-puntos">Vista de detalle (1,5 puntos)<a class="headerlink" href="#vista-de-detalle-15-puntos" title="Permanent link">&para;</a></h2>
<p>La nueva pantalla mostrará los datos de un <em>item</em> al hacer <em>tap</em>. Como una vez en los detalles queremos poder volver atrás al listado de forma sencilla, lo mejor es usar un <em>navigation controller</em>:</p>
<h3 id="el-navigation-controller">El <em>navigation controller</em><a class="headerlink" href="#el-navigation-controller" title="Permanent link">&para;</a></h3>
<p>En este apartado todavía no estamos implementando la vista de detalle, solo creando la jerarquía de navegación.</p>
<ul>
<li>Selecciona la pantalla de lista y elige la opción de menú <code>Editor &gt; Embed In &gt; Navigation Controller</code>. Aparecerá un nuevo <em>navigation controller</em> que tiene como primer nivel de navegación a la pantalla de lista de items.</li>
<li>Fijate que en la parte superior de la pantalla de items habrá aparecido un espacio reservado para el título y los botones de navegación. Esto puede haber "trastocado" en modo diseño el resto de los elementos de la interfaz (aunque cuando se ejecute la <em>app</em> deberían seguir funcionando bien). Recuerda que puedes volverlos "a su sitio" en modo diseño con el <code>Update Frames</code> del <em>autolayout</em>.</li>
<li>Selecciona la nueva barra de título de la vista de lista y en las propiedades pon como <code>title</code> el recurso que estás mostrando (personajes, autores, comics,...).</li>
</ul>
<h3 id="la-pantalla-de-detalles-del-item">La pantalla de detalles del <em>item</em><a class="headerlink" href="#la-pantalla-de-detalles-del-item" title="Permanent link">&para;</a></h3>
<p>Esta sería la que muestra todos los datos de un personaje, comic, creador,... junto a su imagen si es que la tiene.</p>
<blockquote>
<p>Si quieres usar una tabla estática para diseñar esta pantalla debes usar como <em>controller</em> una clase que herede de <code>UITableViewController</code></p>
</blockquote>
<h3 id="creacion-de-la-interfaz-y-conexion-con-la-pantalla-anterior">Creación de la interfaz y conexión con la pantalla anterior<a class="headerlink" href="#creacion-de-la-interfaz-y-conexion-con-la-pantalla-anterior" title="Permanent link">&para;</a></h3>
<ul>
<li>Arrastra un "view controller" al <em>storyboard</em></li>
<li>En la pantalla anterior, haz <code>ctrl+arrastrar</code> entre la celda prototipo y la pantalla actual. Elige el tipo adecuado de <em>segue</em>.</li>
<li>Implementa una clase <code>DetalleViewController</code> que herede de <code>UIViewController</code> y asóciala a esta pantalla.</li>
</ul>
<h3 id="implementacion-de-la-funcionalidad">Implementación de la funcionalidad<a class="headerlink" href="#implementacion-de-la-funcionalidad" title="Permanent link">&para;</a></h3>
<ul>
<li>Define en el <code>DetalleViewController</code> una propiedad del tipo de recurso que estés mostrando (<code>RCCharacterObject</code>, <code>RCComicsObject</code>, <code>RCCreatorObject</code>,...)</li>
<li>En el <code>prepareForSegue</code> de la pantalla de lista instancia esta propiedad para que contenga el objeto a mostrar. Para saber qué fila de la tabla se ha seleccionado puedes seleccionar la propiedad del objeto tabla llamada <code>indexPathForSelectedRow</code>, que almacena el <code>indexPath</code> de la fila seleccionada. La propiedad <code>row</code> de este <em>index path</em> es el número de fila.</li>
<li>Usa los componentes que consideres necesarios para mostrar los datos del objeto (no es necesario que sean todos, solo los que quieras, para probar que funciona). Tendrás que crear un <em>outlet</em> por cada campo, y rellenar los campos en el <code>viewDidLoad</code> del <em>controller</em>. Puedes consultar la referencia de clases en la <a href="http://cocoadocs.org/docsets/Marvelous/0.7.3/">documentación <em>online</em> de Marvelous</a> para saber qué propiedades tiene cada objeto. La referencia está en Objective-C pero no es difícil deducir qué es cada propiedad</li>
<li>Entre otras cosas, en esta pantalla deberías mostrar la imagen del personaje, comic, creador o lo que sea que hayas elegido, a un tamaño relativamente pequeño. La carga de la imagen deberías hacerla en un hilo secundario, para no paralizar la interfaz de usuario si la imagen tarda en cargarse:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">colaBackground</span> <span class="p">=</span> <span class="n">OperationQueue</span><span class="p">()</span>
<span class="n">colaBackground</span><span class="p">.</span><span class="n">addOperation</span> <span class="p">{</span>
    <span class="c1">//SUPONIENDO que la variable con el personaje se llama &quot;personaje&quot;</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">thumb</span> <span class="p">=</span> <span class="n">personaje</span><span class="p">.</span><span class="n">thumbnail</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="s">&quot;</span><span class="si">\(</span><span class="n">thumb</span><span class="p">.</span><span class="n">basePath</span><span class="p">!</span><span class="si">)</span><span class="s">/portrait_uncanny.</span><span class="si">\(</span><span class="n">thumb</span><span class="p">.</span><span class="kd">extension</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span>
      <span class="c1">//cambiamos la URL por https://. Necesario en iOS&gt;=9</span>
      <span class="kd">let</span> <span class="nv">urlHttps</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">replacingOccurrences</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="s">&quot;https&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">urlFinal</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="n">urlHttps</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">do</span> <span class="p">{</span>
               <span class="kd">let</span> <span class="nv">datos</span> <span class="p">=</span> <span class="k">try</span> <span class="n">Data</span><span class="p">(</span><span class="n">contentsOf</span><span class="p">:</span><span class="n">urlFinal</span><span class="p">)</span>
                <span class="k">if</span> <span class="kd">let</span> <span class="nv">img</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">datos</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">OperationQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">addOperation</span> <span class="p">{</span>
                        <span class="c1">//suponiendo que el outlet de la imagen se llama &quot;miImagen&quot;</span>
                        <span class="kc">self</span><span class="p">.</span><span class="n">miImagen</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">img</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">{</span>             
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Puedes consultar <a href="http://developer.marvel.com/documentation/images">esta página</a> para ver el formato de las URL de las imágenes. Básicamente se construyen con una trayectoria base seguidas de un "modificador" de aspecto y tamaño (<code>portrait_small</code>, <code>landscape_medium</code>, ...) y la extensión del archivo.</p>
<blockquote>
<p>En el código anterior se obtiene la URL de la imagen y luego se cambia el <code>http:</code> por <code>https:</code>. En iOS&gt;=9 una <em>app</em> no puede hacer una petición a una URL web si no es con <code>https:</code>. Esto debería cambiarse en la propia librería <code>Marvelous</code>, pero podemos salir del paso con este pequeño <em>parche</em>.</p>
</blockquote>
<h2 id="imagen-a-tamano-completo-1-punto">Imagen a tamaño completo (1 punto)<a class="headerlink" href="#imagen-a-tamano-completo-1-punto" title="Permanent link">&para;</a></h2>
<p>Implementa una nueva pantalla en la que se pueda ver solo la imagen a mayor tamaño. Haz que la transición se realice con un <em>segue</em> modal pulsando sobre algún botón "ver imagen ampliada" (si tienes activadas las <em>size classes</em> el tipo equivalente es <code>present modally</code>).</p>
<p>En el API de Marvel, la URL de la imagen a tamaño completo se consigue simplemente concatenando las propiedades <code>basePath</code> y <code>extension</code>, y añadiendo un punto entre ellas, de modo que sería prácticamente igual al código para cargar la imagen en la pantalla anterior pero sin poner el "modificador" (en el ejemplo era <code>portrait-uncanny</code>).</p>
<p>La pantalla debe tener algún botón o similar para volver a la anterior.</p>
<h2 id="vista-acerca-de-025-puntos">Vista "Acerca de" (0,25 puntos)<a class="headerlink" href="#vista-acerca-de-025-puntos" title="Permanent link">&para;</a></h2>
<p>Esta es la segunda de las pantallas del <em>tab bar</em>. Simplemente debe consistir en una imagen estática y un <em>text view</em> con información sobre la aplicación.</p>
<h2 id="apendice-creacion-de-la-plantilla-de-proyecto-desde-cero">Apéndice: creación de la plantilla de proyecto desde cero<a class="headerlink" href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Esta sección está solo para que veas cómo se ha creado la plantilla de proyecto, no es necesario que lo hagas si has usado la plantilla que está en moodle.</p>
</blockquote>
<p>Hasta Xcode 11 no había ningún sistema de gestión de dependencias de librerías de terceros para iOS incluido en el IDE. Desde Xcode 11 tenemos el <em>Swift Package Manager</em>, pero durante todo el tiempo que no ha existido una herramienta propia de Apple, la comunidad ha tenido que "cubrir ese hueco" desarrollando gestores de paquetes para iOS. Probablemente el más conocido sea<a href="http://cocoapods.org"><em>CocoaPods</em></a> que es el que vamos a usar aquí.</p>
<p>Cocoapods es a la vez un repositorio de librerías y un gestor de dependencias para instalar automáticamente estas librerías en nuestros proyectos. Hay muchas librerías de terceros disponibles con este sistema, puedes buscarlas desde la página de CocoaPods.</p>
<p>Para instalar <code>cocoapods</code>, desde la terminal hacer</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Con --pre decimos que queremos instalar la última versión, aunque sea RC</span>
sudo gem install cocoapods  --pre
</code></pre></div>
<blockquote>
<p>Esto instala la herramienta desde un repositorio de Internet, así que  necesitarás conectividad...y paciencia, según vaya la red.</p>
</blockquote>
<p>Si todo va bien se instalará un comando llamado <code>pod</code>. Ejecútalo desde la terminal para comprobar al menos que existe. Ahora debes seguir estos pasos:</p>
<ol>
<li>Crear un proyecto Xcode para la aplicación. Llámalo por ejemplo <code>Marvel</code></li>
<li>Con un editor de textos cualquiera, crear un fichero llamado <code>Podfile</code> en el directorio del proyecto (el que contiene el fichero <code>.xcodeproj</code>). Este archivo debe contener la configuración y las dependencias (o <em>pods</em>) del proyecto</li>
</ol>
<div class="highlight"><pre><span></span><code>//SUSTITUYE la versión de ios por la que quieras usar como target de tu app
platform :ios, <span class="s1">&#39;12.0&#39;</span>
use_frameworks!
//SUSTITUYE <span class="s1">&#39;Marvel&#39;</span> por el nombre de tu proyecto, si no se llama así!!!
target <span class="s1">&#39;Marvel&#39;</span> <span class="k">do</span>
   pod <span class="s1">&#39;Marvelous&#39;</span>
end
</code></pre></div>
<ol start="5">
<li>Abre una terminal. Muévete hasta el directorio donde está el <code>Podfile</code> y desde él ejecuta el comando <code>pod install</code>. Las dependencias de nuestro proyecto se bajarán automáticamente y se creará en el directorio actual un <code>Marvel.xcworkspace</code></li>
<li><strong>A partir de ahora para trabajar en el proyecto siempre abriremos el fichero Marvel.xcworkspace</strong>, que es un <em>workspace</em> de Xcode (un conjunto de proyectos), no el proyecto Marvel directamente (<strong>NO ABRAS DIRECTAMENTE el <code>Marvel.xcodeproj</code></strong>).</li>
<li>Veremos que en Xcode se muestra nuestro proyecto y además un proyecto adicional llamado <code>Pods</code>, que contiene las dependencias. Este último no lo tocaremos, pero es necesario que esté ahí para que funcione el nuestro.</li>
</ol>
<h3 id="uso-de-marvelous">Uso de <code>Marvelous</code><a class="headerlink" href="#uso-de-marvelous" title="Permanent link">&para;</a></h3>
<blockquote>
<p>ANTES de empezar a escribir código asegúrate de hacer en Xcode un <code>Product &gt; Clean Build Folder</code>, y <code>Product &gt; Build</code> para asegurarse de que las dependencias están compiladas y accesibles en nuestro código.</p>
<p>Para poder hacer llamadas al API de Marvel necesitas un par de claves. Las puedes ver, una vez dado de alta y autentificado en Marvel, en <code>https://developer.marvel.com/account</code></p>
</blockquote>
<p>El siguiente código ya está metido en la plantilla, si te la has bajado. Solo es necesario poner en marcha el proyecto para probar si sale en la consola la lista de personajes.</p>
<p>Para probar de manera sencilla la librería <code>Marvelous</code> puedes poner este <code>import</code> en el <code>ViewController</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">import</span> <span class="nc">Marvelous</span>
</code></pre></div>
<p>Y ahora copiar la siguiente función en el <em>view controller</em>, quemuestran en la consola todos los personajes cuyo nombre comienza por una determinada cadena.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">mostrarPersonajes</span><span class="p">(</span><span class="n">comienzanPor</span> <span class="n">cadena</span> <span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">marvelAPI</span> <span class="p">=</span> <span class="n">RCMarvelAPI</span><span class="p">()</span>
        <span class="c1">//PUEDES CAMBIAR ESTO PARA PONER TUS CLAVES</span>
        <span class="n">marvelAPI</span><span class="p">.</span><span class="n">publicKey</span> <span class="p">=</span> <span class="s">&quot;a6927e7e15930110aade56ef90244f6d&quot;</span>
        <span class="n">marvelAPI</span><span class="p">.</span><span class="n">privateKey</span> <span class="p">=</span> <span class="s">&quot;487b621fc3c0d6f128b468ba86c99c508f24d357&quot;</span>
        <span class="kd">let</span> <span class="nv">filtro</span> <span class="p">=</span> <span class="n">RCCharacterFilter</span><span class="p">()</span>
        <span class="n">filtro</span><span class="p">.</span><span class="n">nameStartsWith</span> <span class="p">=</span> <span class="n">cadena</span>
        <span class="n">marvelAPI</span><span class="p">.</span><span class="n">characters</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="n">filtro</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">resultados</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
            <span class="k">if</span> <span class="kd">let</span> <span class="nv">personajes</span> <span class="p">=</span> <span class="n">resultados</span> <span class="k">as</span><span class="p">!</span> <span class="p">[</span><span class="n">RCCharacterObject</span><span class="p">]?</span> <span class="p">{</span>
                <span class="k">for</span> <span class="n">personaje</span> <span class="k">in</span> <span class="n">personajes</span> <span class="p">{</span>
                    <span class="bp">print</span><span class="p">(</span><span class="n">personaje</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Hay </span><span class="si">\(</span><span class="n">personajes</span><span class="p">.</span><span class="bp">count</span><span class="si">)</span><span class="s"> personajes&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Puedes llamar a la función anterior desde el <code>viewDidLoad</code> del <em>view controller</em></p>
<div class="highlight"><pre><span></span><code><span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
    <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
    <span class="n">mostrarPersonajes</span><span class="p">(</span><span class="n">comienzanPor</span><span class="p">:</span> <span class="s">&quot;Spider&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>