
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>Miniproyecto - IUDM-iOS-basico</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#miniproyecto-app-marvel" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="IUDM-iOS-basico" class="md-header__button md-logo" aria-label="IUDM-iOS-basico" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IUDM-iOS-basico
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Miniproyecto
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="IUDM-iOS-basico" class="md-nav__button md-logo" aria-label="IUDM-iOS-basico" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    IUDM-iOS-basico
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../2_vistas/apuntes/" class="md-nav__link">
        Vistas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../2_vistas/ejercicios/" class="md-nav__link">
        Ejercicios sobre vistas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../3_autolayout/apuntes/" class="md-nav__link">
        Autolayout
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../4_tablas/apuntes/" class="md-nav__link">
        Tablas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../4_tablas/ejercicios/" class="md-nav__link">
        Ejercicios de tablas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../1_controllers/apuntes/" class="md-nav__link">
        Controladores
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../1_controllers/ejercicios/" class="md-nav__link">
        Ejercicios de controladores
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../5_contenedores/apuntes/" class="md-nav__link">
        Controladores contenedores
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../complementario/concurrencia/" class="md-nav__link">
        Concurrencia en iOS
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Miniproyecto
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Miniproyecto
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pasos-iniciales" class="md-nav__link">
    Pasos iniciales
  </a>
  
    <nav class="md-nav" aria-label="Pasos iniciales">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registro-en-la-api-de-marvel-opcional" class="md-nav__link">
    Registro en la API de Marvel (Opcional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceso-a-la-api" class="md-nav__link">
    Acceso a la API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uso-de-la-plantilla-de-proyecto" class="md-nav__link">
    Uso de la plantilla de proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-que-debe-tener-la-aplicacion" class="md-nav__link">
    Estructura que debe tener la aplicaci√≥n
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-de-lista-2-puntos" class="md-nav__link">
    Vista de lista (2 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Vista de lista (2 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-la-interfaz" class="md-nav__link">
    Crear la interfaz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-el-controller" class="md-nav__link">
    Crear el controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mostrar-los-resultados-en-la-tabla" class="md-nav__link">
    Mostrar los resultados en la tabla
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-de-detalle-15-puntos" class="md-nav__link">
    Vista de detalle (1,5 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Vista de detalle (1,5 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-navigation-controller" class="md-nav__link">
    El navigation controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-la-interfaz-y-conexion-con-la-pantalla-de-lista" class="md-nav__link">
    Creaci√≥n de la interfaz y conexi√≥n con la pantalla de lista
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion-de-la-funcionalidad" class="md-nav__link">
    Implementaci√≥n de la funcionalidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-acerca-de-05-puntos" class="md-nav__link">
    Vista "Acerca de" (0,5 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero" class="md-nav__link">
    Ap√©ndice: creaci√≥n de la plantilla de proyecto desde cero
  </a>
  
    <nav class="md-nav" aria-label="Ap√©ndice: creaci√≥n de la plantilla de proyecto desde cero">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uso-de-marvelous" class="md-nav__link">
    Uso de Marvelous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pasos-iniciales" class="md-nav__link">
    Pasos iniciales
  </a>
  
    <nav class="md-nav" aria-label="Pasos iniciales">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registro-en-la-api-de-marvel-opcional" class="md-nav__link">
    Registro en la API de Marvel (Opcional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceso-a-la-api" class="md-nav__link">
    Acceso a la API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uso-de-la-plantilla-de-proyecto" class="md-nav__link">
    Uso de la plantilla de proyecto
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estructura-que-debe-tener-la-aplicacion" class="md-nav__link">
    Estructura que debe tener la aplicaci√≥n
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-de-lista-2-puntos" class="md-nav__link">
    Vista de lista (2 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Vista de lista (2 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-la-interfaz" class="md-nav__link">
    Crear la interfaz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-el-controller" class="md-nav__link">
    Crear el controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mostrar-los-resultados-en-la-tabla" class="md-nav__link">
    Mostrar los resultados en la tabla
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-de-detalle-15-puntos" class="md-nav__link">
    Vista de detalle (1,5 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Vista de detalle (1,5 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-navigation-controller" class="md-nav__link">
    El navigation controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-la-interfaz-y-conexion-con-la-pantalla-de-lista" class="md-nav__link">
    Creaci√≥n de la interfaz y conexi√≥n con la pantalla de lista
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion-de-la-funcionalidad" class="md-nav__link">
    Implementaci√≥n de la funcionalidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vista-acerca-de-05-puntos" class="md-nav__link">
    Vista "Acerca de" (0,5 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero" class="md-nav__link">
    Ap√©ndice: creaci√≥n de la plantilla de proyecto desde cero
  </a>
  
    <nav class="md-nav" aria-label="Ap√©ndice: creaci√≥n de la plantilla de proyecto desde cero">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uso-de-marvelous" class="md-nav__link">
    Uso de Marvelous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="miniproyecto-app-marvel">"Miniproyecto": <em>app</em> Marvel<a class="headerlink" href="#miniproyecto-app-marvel" title="Permanent link">&para;</a></h1>
<p>Este "miniproyecto" trata de hacer una peque√±a aplicaci√≥n bas√°ndose en <a href="https://developer.marvel.com/">el API</a> de la editorial Marvel, que nos permite consultar informaci√≥n sobre los personajes, los <em>comics</em>, las <em>series</em>,...</p>
<p><img alt="" src="../images/marvel_api_splash.png" /></p>
<h2 id="pasos-iniciales">Pasos iniciales<a class="headerlink" href="#pasos-iniciales" title="Permanent link">&para;</a></h2>
<h3 id="registro-en-la-api-de-marvel-opcional">Registro en la API de Marvel (Opcional)<a class="headerlink" href="#registro-en-la-api-de-marvel-opcional" title="Permanent link">&para;</a></h3>
<p>Para poder usar la API de Marvel hacen falta claves de desarrollador. La plantilla de proyecto disponible en la web <strong>ya tiene unas claves incorporadas, que puedes usar, con lo que en principio no es necesario que te registres</strong>.</p>
<p>Con esas claves se pueden hacer <strong>3000 peticiones diarias al API</strong>, seguramente suficientes para su uso en clase, no somos tanta gente. No obstante, tambi√©n puedes registrarte desde el <a href="https://developer.marvel.com/">portal de desarrolladores</a> de Marvel para poder obtener claves propias. </p>
<h3 id="acceso-a-la-api">Acceso a la API<a class="headerlink" href="#acceso-a-la-api" title="Permanent link">&para;</a></h3>
<p>La API de Marvel es REST, por lo que acepta peticiones HTTP y devuelve los datos en JSON. No obstante hacerlas directamente con los APIs de iOS ser√≠a un poco engorroso, por lo que vamos a usar un par de librer√≠as que nos faciliten no solo hacer la petici√≥n en s√≠ sino sobre todo <em>parsear</em> el JSON. Usaremos una librer√≠a adicional llamada Marvelous, que encapsula las llamadas al API en una serie de clases de modo que no tenemos que hacer peticiones HTTP directamente. </p>
<p>Marvelous se distribuye como un "paquete" de la herramienta <a href="https://cocoapods.org/">CocoaPods</a>, que es un repositorio/sistema de gesti√≥n de paquetes que surgi√≥ antes del que ahora es oficial en Swift, el <a href="https://www.swift.org/package-manager/">Swift Package Manager</a>. Al tardar tanto en aparecer una herramienta oficial, otras de terceros llenaron este vac√≠o como Cocoapods o Carthage.</p>
<p>Para acelerar el trabajo en el aula ten√©is disponible en moodle la plantilla de <em>workspace</em> ya creada con CocoaPods. Si quieres ver c√≥mo se ha hecho o crear tus proyectos con otras librer√≠as de CocoaPods puedes consultar el <a href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero">Ap√©ndice</a>.</p>
<h2 id="uso-de-la-plantilla-de-proyecto">Uso de la plantilla de proyecto<a class="headerlink" href="#uso-de-la-plantilla-de-proyecto" title="Permanent link">&para;</a></h2>
<p>En la plantilla de workspace descargada <strong>abre el fichero Marvel.xcworkspace</strong>, que es un <em>workspace</em> de Xcode (un conjunto de proyectos), no el proyecto Marvel directamente (<strong>NO ABRAS DIRECTAMENTE el <code>Marvel.xcodeproj</code></strong>). Si lo has abierto correctamente, deber√≠as ver dos proyectos, uno llamado <code>Marvel</code>, y otro llamado <code>Pods</code>. El proyecto principal es el primero, el segundo son librer√≠as auxiliares. </p>
<p><strong>Primero hay que hacer un <code>Product &gt; Clean Build Folder</code>, y <code>Product &gt; Build</code></strong> para asegurarse de que las dependencias est√°n compiladas y accesibles en nuestro c√≥digo. Una vez hecho esto podemos ejecutar la app, en la consola aparecer√° una lista de personajes cuyo nombre empieza por "Spider". Puedes mirar el c√≥digo del View Controller para ver c√≥mo se ha hecho.</p>
<p>Una vez hecho el <em>build</em>, puedes comprobar si la conexi√≥n con el API funciona bien ejecutando la aplicaci√≥n, no ver√°s nada en la pantalla del simulador pero en la consola de Xcode deber√≠a aparecer una lista de personajes que comienzan por "spider". Puedes examinar el c√≥digo del view controller para ver c√≥mo se ha hecho, usamos una librer√≠a auxiliar llamada <code>Marvelous</code> que implementa el acceso al API de forma sencilla.</p>
<h2 id="estructura-que-debe-tener-la-aplicacion">Estructura que debe tener la aplicaci√≥n<a class="headerlink" href="#estructura-que-debe-tener-la-aplicacion" title="Permanent link">&para;</a></h2>
<p>Para que te hagas una idea de la estructura, se muestra el <em>storyboard</em> de la aplicaci√≥n ya terminada</p>
<p><img alt="" src="../images/storyboard_marvel_reducido.png" /></p>
<p>En la aplicaci√≥n se podr√° buscar, listar y mostrar los detalles de alguno de los recursos que ofrece el API. Elige t√∫ lo que prefieras: personajes, comics, creadores... </p>
<p>Puedes comenzar embebiendo la pantalla inicial que aparece en el <em>storyboard</em> en un <em>tab bar</em>: selecci√≥nala y en el men√∫ <code>Editor</code> elige <code>Embed In &gt; Tab Bar Controller</code>.</p>
<h2 id="vista-de-lista-2-puntos">Vista de lista (2 puntos)<a class="headerlink" href="#vista-de-lista-2-puntos" title="Permanent link">&para;</a></h2>
<p>Esta debe ser una pantalla con una barra de b√∫squeda y una vista de tabla en la que se puede buscar y listar el recurso elegido (por ejemplo personajes). El resultado final ser√° algo como:</p>
<p><img alt="" src="../images/maestro.png" /></p>
<p>Ve a la primera (y por el momento √∫nica) pantalla de contenido del <em>tab bar</em>, selecciona la barra inferior y en las propiedades <code>bar item</code> ponle un t√≠tulo apropiado (por ejemplo "Personajes") y un icono relevante.</p>
<blockquote>
<p>Si no te gusta ninguno de los SF Symbols que tiens disponibles en  iOS, hay unas cuantas webs de donde puedes coger iconos "planos", por ejemplo <a href="https://www.iconfinder.com/iconsets/ios-7-icons">https://www.iconfinder.com/iconsets/ios-7-icons</a> o <a href="https://www.flaticon.com/uicons/interface-icons">https://www.flaticon.com/uicons/interface-icons</a></p>
</blockquote>
<h3 id="crear-la-interfaz">Crear la interfaz<a class="headerlink" href="#crear-la-interfaz" title="Permanent link">&para;</a></h3>
<p>La tabla:</p>
<ul>
<li>Arrastra una <em>table view</em> a la pantalla de "personajes" (o "comics", o lo que hayas elegido)</li>
<li>Selecciona la tabla y en las propiedades crea un prototipo de celda incrementando el <code>Prototype cells</code> a 1.</li>
<li>Selecciona el prototipo de celda reci√©n creado (el <code>table view cell</code>) y en las propiedades elige como <code>style</code> el valor <code>Basic</code>, para poder usar uno de los tipos predefinidos de celda y no tener que hacerlo t√∫.</li>
<li>Ya que est√°s, ponle un <code>identifier</code> a la celda prototipo. Recuerda que era un identificador elegido por t√≠ que luego tienes que usar en Swift para recuperar una celda "reciclada".  </li>
</ul>
<p>La barra de b√∫squeda no se inserta como componente visual sino por c√≥digo, as√≠ que la dejamos de momento (cuidado, hay un <em>search bar</em> en la biblioteca de componentes pero es para versiones de iOS anteriores a la 13).</p>
<p>Nos falta fijar el <em>autolayout</em>. Queremos que la tabla ocupe toda el √°rea de la pantalla. Para ello lo m√°s sencillo es ponerle 4 restricciones de distancia 0 a los bordes.</p>
<h3 id="crear-el-controller">Crear el <em>controller</em><a class="headerlink" href="#crear-el-controller" title="Permanent link">&para;</a></h3>
<p>Vamos a crear un <em>view controller</em> para esta primera pantalla</p>
<ul>
<li>Crea una nueva clase de Cocoa Touch llamada <code>ListaController</code> y haz que sea una subclase de <code>UIViewController</code></li>
<li>As√≠gnale ese <em>controller</em> en el <em>storyboard</em> a la pantalla con la tabla. Recuerda que esto se hace a trav√©s del <code>identity inspector</code>.</li>
</ul>
<p>Como dec√≠amos, la barra de b√∫squeda se crea por c√≥digo Swift. En iOS, desde la versi√≥n 13 esto se controla con la clase <code>UISearchController</code>. Este utiliza el patr√≥n <em>delegaci√≥n</em> para gestionar los eventos de escribir en la barra, pulsar "buscar" en el teclado, etc. El objeto que act√∫e como <em>delegate</em> del <code>UISearchController</code> debe implementar el protocolo <code>UISearchResultsUpdating</code></p>
<p>Siguiendo la filosof√≠a MVC (Monster View Controller üòÖ) para simplificar haremos que la barra de b√∫squeda est√© en el <em>view controller</em> de la pantalla actual, y √©ste sea el <em>delegate</em>.</p>
<p><strong>Crea en <code>ListaController</code> un <em>outlet</em> para la tabla</strong>, lo usaremos en un momento (aqu√≠ supondremos que lo llamas "tabla").</p>
<p><strong>Declara un <code>UISearchController</code> en el <code>ListaController</code> , inicial√≠zalo y establece sus propiedades en el <code>viewDidLoad</code></strong> (al a√±adir el c√≥digo Xcode se ‚Äúquejar√°‚Äù" de que el controller no es conforme a <code>UISearchResultsUpdating</code>, lo arreglaremos a continuaci√≥n).</p>
<div class="highlight"><pre><span></span><code><span class="c1">//esto deber√≠a ser una propiedad de ListaController</span>
<span class="kd">var</span> <span class="nv">searchController</span> <span class="p">:</span> <span class="bp">UISearchController</span><span class="p">!</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
    <span class="c1">//..aqu√≠ podr√≠a haber m√°s c√≥digo</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">searchController</span> <span class="p">=</span> <span class="bp">UISearchController</span><span class="p">(</span><span class="n">searchResultsController</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">//el delegate somos nosotros (ListaController)</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">searchController</span><span class="p">.</span><span class="n">searchResultsUpdater</span> <span class="p">=</span> <span class="kc">self</span>
    <span class="c1">//Configuramos el search controller</span>
    <span class="c1">//esto ser√≠a true si quisi√©ramos mostrar los resultados de b√∫squeda en un sitio distinto a la tabla</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">searchController</span><span class="p">.</span><span class="n">obscuresBackgroundDuringPresentation</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="c1">//lo que aparece en la barra de b√∫squeda antes de teclear nada</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">placeholder</span> <span class="p">=</span> <span class="s">&quot;Buscar texto&quot;</span>
    <span class="c1">//A√±adimos la barra de b√∫squeda a la tabla</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">sizeToFit</span><span class="p">()</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">tabla</span><span class="p">.</span><span class="n">tableHeaderView</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span>
<span class="p">}</span>
</code></pre></div>
<p>A√±ade <code>UISearchResultsUpdating</code> a la cabecera del controller para que sea el <em>delegate</em> de la barra de b√∫squeda:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ListaController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="bp">UISearchResultsUpdating</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Xcode</p>
<p>Al a√±adir el <code>UISearchResultsUpdating</code> Xcode se "quejar√°"" de que falta implementar el m√©todo <code>updateSearchResults</code>. Puedes darle al "fix" del mensaje de error o copiar el c√≥digo que viene a continuaci√≥n. </p>
</div>
<p>En el <code>ListaController</code> implementa el m√©todo <code>updateSearchResults</code>, que se llamar√° cuando se escriba algo en la barra. Con cada pulsaci√≥n de tecla se llamar√° una vez al m√©todo. Para probar que funciona, de momento basta que imprimas en la consola el texto escrito en la barra.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">updateSearchResults</span><span class="p">(</span><span class="k">for</span> <span class="n">searchController</span><span class="p">:</span> <span class="bp">UISearchController</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">textoBuscado</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">text</span><span class="p">!</span>
    <span class="c1">//recortamos caracteres en blanco</span>
    <span class="kd">let</span> <span class="nv">textoBuscadoTrim</span> <span class="p">=</span> <span class="n">textoBuscado</span><span class="p">.</span><span class="n">trimmingCharacters</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">textoBuscadoTrim</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Ejecuta la <em>app</em> y comprueba que efectivamente funciona lo hecho hasta ahora.</p>
<div class="admonition info">
<p class="admonition-title">Throttling de las peticiones</p>
<p>Si con cada pulsaci√≥n de tecla lanzas una b√∫squeda al API va a ser todo muy lento e ineficiente. Es mejor que la lances cuando el usuario deje de teclear, dicho de otro modo, cuando hayan pasado X segundos sin escribir m√°s caracteres. A esto se lo conoce como <em>throttling</em>. </p>
<p>Puedes usar <a href="../Throttler.swift">esta implementaci√≥n</a> para no tener que escribirlo t√∫. Puedes a√±adirlo al proyecto con la opci√≥n de men√∫ de <code>File &gt; Add Files to Marvel...</code> seleccionando el archivo y <strong>asegur√°ndote de que est√° marcada la opci√≥n</strong> de <code>Copy items if needed</code> (si no, incluir√° solo una referencia al archivo pero no este en s√≠).</p>
<p>Una vez a√±adida la clase <code>Throttler</code>, puedes crear una instancia de la clase en <code>ListaController</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">throttler</span> <span class="p">=</span> <span class="n">Throttler</span><span class="p">(</span><span class="n">minimumDelay</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1">//el delay est√° en segundos</span>
</code></pre></div>
<p>y luego le puedes pasar a su m√©todo <code>throttle</code> en una clausura el c√≥digo que quieras usar con <em>throttling</em>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">updateSearchResults</span><span class="p">(</span><span class="k">for</span> <span class="n">searchController</span><span class="p">:</span> <span class="bp">UISearchController</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">throttler</span><span class="p">.</span><span class="n">throttle</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">textoBuscado</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">text</span><span class="p">!</span>
        <span class="kd">let</span> <span class="nv">textoBuscadoTrim</span> <span class="p">=</span> <span class="n">textoBuscado</span><span class="p">.</span><span class="n">trimmingCharacters</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span>
        <span class="bp">print</span><span class="p">(</span><span class="n">textoBuscadoTrim</span><span class="p">)</span>
    <span class="p">}</span>  
<span class="p">}</span>
</code></pre></div>
</div>
<p>Tras todo esto <strong>a√±ade tu propio c√≥digo Swift para que cuando cambie el texto de la barra se haga la llamada a la API de Marvel</strong>. Por el momento lo m√°s simple es mostrar los resultados con <code>print</code>. Puedes asign√°rselos tambi√©n a un array que sea una propiedad del <em>controller</em>, para que luego sean sencillos de mostrar en la tabla.</p>
<h3 id="mostrar-los-resultados-en-la-tabla">Mostrar los resultados en la tabla<a class="headerlink" href="#mostrar-los-resultados-en-la-tabla" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Aqu√≠ los pasos ya no est√°n tan detallados, ve poco a poco</p>
</div>
<p>Una vez verificado que funcionan las llamadas al API desde la barra de b√∫sqeda, puedes hacer que los resultados aparezcan en la tabla. Recuerda que necesitas un <em>datasource</em> para ella, y que para simplificar puedes hacer que sea el <code>ListaController</code>. A grandes rasgos esto implica:</p>
<ul>
<li>Que, como dec√≠amos antes, el <em>controller</em> debe tener acceso a los datos, por ejemplo guard√°ndolos en una propiedad que sea un array de <code>RCCharacter</code>, <code>RCComic</code> o lo que sea que est√°s usando.</li>
<li>Que tienes que asignar el valor de la propiedad <code>datasource</code> de la tabla en el <code>ListaViewController</code> a <code>self</code> (el <em>view controller</em>) (o conectar gr√°ficamente en el <code>connections inspector</code> el <em>outlet</em> <code>datasource</code> con el <em>controller</em>) .</li>
<li>Que el <code>ListaController</code> debe implementar el protocolo <code>UITableViewDataSource</code>. Hay que poner en la cabecera que esto es as√≠, y adem√°s implementar los correspondientes m√©todos en el c√≥digo del <em>controller</em>, uno para devolver el n√∫mero de filas en la tabla y otro para devolver una celda dado su <code>indexPath</code>  (te deber√≠a ayudar Xcode con el <em>stub</em> de los m√©todos pero si no lo hace consulta los apuntes del tema de tablas o el ejercicio que hiciste en esa sesi√≥n).</li>
<li>Para hacerlo m√°s eficiente, no llames al API si la longitud de lo escrito en el campo de texto es menor o igual que 2 (por ejemplo, puedes probar otro l√≠mite).</li>
</ul>
<p>Cada vez que se haga una b√∫squeda y se guarden datos en el array tendr√°s que decirle a iOS que vuelva a redibujar la tabla llamando al m√©todo del <em>table view</em> llamado <code>reloadData()</code>. Cuidado, porque al ser una actualizaci√≥n de la interfaz debes asegurarte de que esto lo est√°s haciendo desde el <em>thread</em> principal, algo como:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//sustituye self.tabla por el outlet que hayas definido</span>
<span class="c1">//para acceder a la tabla desde el controlador</span>
<span class="n">OperationQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">addOperation</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">tabla</span><span class="p">.</span><span class="n">reloadData</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Una vez terminado todo esto, esta pantalla deber√≠a ser casi totalmente funcional. Solo quedar√≠a ver los detalles de cada <em>item</em> al hacer <em>tap</em> sobre √©l.</p>
<p>Opcionalmente <strong>(0,25 puntos extra)</strong>, puedes hacer que aparezca un <em>spinner</em> mientras se est√° procesando la petici√≥n, para que el usuario sepa que el sistema est√° esperando datos. Los <em>spinners</em> en iOS se denominan <em>Activity Indicators</em>. Tendr√≠as que:</p>
<ol>
<li>Definir el <em>activity indicator</em> como variable miembro del <code>ListaController</code>
    <div class="highlight"><pre><span></span><code><span class="kd">var</span> <span class="nv">miSpinner</span> <span class="p">=</span> <span class="bp">UIActivityIndicatorView</span><span class="p">()</span>
</code></pre></div></li>
<li>Fijar sus propiedades en el <code>viewDidLoad()</code>
    <div class="highlight"><pre><span></span><code><span class="c1">//que se oculte autom√°ticamente al pararse</span>
<span class="n">miSpinner</span><span class="p">.</span><span class="n">hidesWhenStopped</span> <span class="p">=</span> <span class="kc">true</span>
<span class="c1">//lo a√±adimos a la vista principal del controller actual</span>
<span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">miSpinner</span><span class="p">)</span>
<span class="c1">//lo centramos en la pantalla</span>
<span class="n">miSpinner</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span>
<span class="n">miSpinner</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">y</span>
<span class="c1">//nos aseguramos que est√° al frente y no tapado por la tabla</span>
<span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bringSubviewToFront</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">miSpinner</span><span class="p">)</span>
</code></pre></div></li>
<li>Para poner en marcha el <em>activity indicator</em>, llama a su m√©todo <code>startAnimating()</code>, y para pararlo a <code>stopAnimating()</code>. </li>
</ol>
<h2 id="vista-de-detalle-15-puntos">Vista de detalle (1,5 puntos)<a class="headerlink" href="#vista-de-detalle-15-puntos" title="Permanent link">&para;</a></h2>
<p>La nueva pantalla mostrar√° los datos de un <em>item</em> al hacer <em>tap</em>. Como una vez en los detalles queremos poder volver atr√°s al listado de forma sencilla, lo mejor es usar un <em>navigation controller</em>:</p>
<h3 id="el-navigation-controller">El <em>navigation controller</em><a class="headerlink" href="#el-navigation-controller" title="Permanent link">&para;</a></h3>
<p>En este apartado todav√≠a no estamos implementando la vista de detalle, solo creando la jerarqu√≠a de navegaci√≥n.</p>
<ul>
<li>En el <em>storyboard</em>, selecciona la pantalla de lista y elige la opci√≥n de men√∫ <code>Editor &gt; Embed In &gt; Navigation Controller</code>. Aparecer√° un nuevo <em>navigation controller</em> que tiene como primer nivel de navegaci√≥n a la pantalla de lista de items.</li>
<li>Fijate que en la parte superior de la pantalla de items habr√° aparecido un espacio reservado para el t√≠tulo y los botones de navegaci√≥n. Selecciona esta  barra de t√≠tulo y en las propiedades pon como <code>title</code> el recurso que est√°s mostrando (personajes, autores, comics,...).</li>
</ul>
<p>La barra de b√∫squeda en un navigation controller deber√≠a estar en la barra de naavegaci√≥n de la parte superior. Nosotros la ten√≠amos definida en la tabla. Quita estas l√≠neas del <code>viewDidLoad()</code> de <code>ListaController</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kc">self</span><span class="p">.</span><span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">sizeToFit</span><span class="p">()</span>
<span class="kc">self</span><span class="p">.</span><span class="n">tabla</span><span class="p">.</span><span class="n">tableHeaderView</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span>
</code></pre></div>
<p>y pon esta nueva:</p>
<div class="highlight"><pre><span></span><code><span class="kc">self</span><span class="p">.</span><span class="n">navigationItem</span><span class="p">.</span><span class="n">searchController</span> <span class="p">=</span> <span class="n">searchController</span>
</code></pre></div>
<h3 id="creacion-de-la-interfaz-y-conexion-con-la-pantalla-de-lista">Creaci√≥n de la interfaz y conexi√≥n con la pantalla de lista<a class="headerlink" href="#creacion-de-la-interfaz-y-conexion-con-la-pantalla-de-lista" title="Permanent link">&para;</a></h3>
<p>Esta pantalla ser√≠a la que muestra los datos de un personaje, comic, creador,... junto a su imagen si es que la tiene.</p>
<ul>
<li>Arrastra un "view controller" al <em>storyboard</em></li>
<li>En la pantalla anterior, haz <code>ctrl+arrastrar</code> entre la celda prototipo y la pantalla actual. Elige el tipo de <em>segue</em> <code>Show</code>.</li>
<li>Usa los componentes de UI que consideres necesarios para mostrar los datos del objeto (no es necesario que sean todos, solo los que quieras, para probar que funciona). Por ejemplo los personajes tienen un nombre o <code>name</code> y una <code>bio</code> (biograf√≠a), entre otros datos (ojo porque la <em>bio</em> en algunos casos est√° vac√≠a, as√≠ que si no aparece puede ser por eso). </li>
<li>La disposici√≥n de los elementos en pantalla es libre, pero deber√≠as usar restricciones de <em>autolayout</em> para que no se descuadren demasiado si cambia la resoluci√≥n de pantalla.</li>
<li>Tendr√°s que crear un <em>outlet</em> paraa cada componente de UI, para poder luego modificar su contenido</li>
<li>Implementa una clase <code>DetalleViewController</code> que herede de <code>UIViewController</code> y as√≥ciala a esta pantalla.</li>
</ul>
<h3 id="implementacion-de-la-funcionalidad">Implementaci√≥n de la funcionalidad<a class="headerlink" href="#implementacion-de-la-funcionalidad" title="Permanent link">&para;</a></h3>
<ul>
<li>Define en el <code>DetalleViewController</code> una propiedad del tipo de recurso que est√©s mostrando (<code>RCCharacterObject</code>, <code>RCComicsObject</code>, <code>RCCreatorObject</code>,...)</li>
<li>
<p>Define en <code>ListaController</code> un m√©todo  <code>prepare(for:sender:)</code>, que se disparar√° al pasar de la pantalla de lista a la de detalle a trav√©s del <em>segue</em> de la celda:
    <div class="highlight"><pre><span></span><code><span class="kr">override</span> <span class="kd">func</span> <span class="nf">prepare</span><span class="p">(</span><span class="k">for</span> <span class="n">segue</span><span class="p">:</span> <span class="bp">UIStoryboardSegue</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">Any</span><span class="p">?)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p>En este m√©todo tienes que pasarle el objeto a mostrar a <code>DetalleViewController</code>. Para saber qu√© fila de la tabla se ha seleccionado puedes usar la propiedad del objeto tabla llamada <code>indexPathForSelectedRow</code>, que almacena el <code>indexPath</code> de la fila seleccionada. La propiedad <code>row</code> de este <em>index path</em> es el n√∫mero de fila.</p>
</li>
<li>Tendr√°s que rellenar los <em>outlets</em> de los componentes de esta pantalla en el <code>viewDidLoad</code> del <em>controller</em>.</li>
<li>Entre otras cosas, en esta pantalla deber√≠as mostrar la imagen del personaje, comic, creador o lo que sea que hayas elegido. La imagen est√° en la propiedad <code>thumbnail</code>, que es el "nombre base", y seg√∫n el sufijo que le pongamos tendremos la imagen en distintos tama√±os (En el apartado <a href="https://developer.marvel.com/documentation/images">"Image Variants"</a> tienes detallados los formatos). La carga de la imagen deber√≠as hacerla en un hilo secundario, para no paralizar la interfaz de usuario si la imagen tarda en cargarse. Aqu√≠ tienes el c√≥digo casi literal (tendr√°s que cambiar alguna variable por las que t√∫ uses)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">colaBackground</span> <span class="p">=</span> <span class="n">OperationQueue</span><span class="p">()</span>
<span class="n">colaBackground</span><span class="p">.</span><span class="n">addOperation</span> <span class="p">{</span>
    <span class="c1">//SUPONIENDO que la variable con el personaje se llama &quot;personaje&quot;</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">thumb</span> <span class="p">=</span> <span class="n">personaje</span><span class="p">.</span><span class="n">thumbnail</span> <span class="p">{</span>
      <span class="c1">//portrait_uncanny es 300x450px. Puedes cambiarlo por otro tama√±o si prefieres</span>
      <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="s">&quot;</span><span class="si">\(</span><span class="n">thumb</span><span class="p">.</span><span class="n">basePath</span><span class="p">!</span><span class="si">)</span><span class="s">/portrait_uncanny.</span><span class="si">\(</span><span class="n">thumb</span><span class="p">.</span><span class="kd">extension</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span>
      <span class="c1">//cambiamos la URL por https://. Necesario en iOS</span>
      <span class="kd">let</span> <span class="nv">urlHttps</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">replacingOccurrences</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="s">&quot;https&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">urlFinal</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="n">urlHttps</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">do</span> <span class="p">{</span>
               <span class="kd">let</span> <span class="nv">datos</span> <span class="p">=</span> <span class="k">try</span> <span class="n">Data</span><span class="p">(</span><span class="n">contentsOf</span><span class="p">:</span><span class="n">urlFinal</span><span class="p">)</span>
                <span class="k">if</span> <span class="kd">let</span> <span class="nv">img</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">datos</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">OperationQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">addOperation</span> <span class="p">{</span>
                        <span class="c1">//suponiendo que el outlet de la imagen se llama &quot;miImagen&quot;</span>
                        <span class="kc">self</span><span class="p">.</span><span class="n">miImagen</span><span class="p">.</span><span class="n">image</span> <span class="p">=</span> <span class="n">img</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">{</span>             
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Puedes consultar <a href="http://developer.marvel.com/documentation/images">esta p√°gina</a> para ver el formato de las URL de las im√°genes. B√°sicamente se construyen con una trayectoria base seguidas de un "modificador" de aspecto y tama√±o (<code>portrait_small</code>, <code>landscape_medium</code>, ...) y la extensi√≥n del archivo.</p>
<blockquote>
<p>En el c√≥digo anterior se obtiene la URL de la imagen y luego se cambia el <code>http:</code> por <code>https:</code>. En iOS, una <em>app</em> no puede hacer una petici√≥n a una URL web si no es <code>https:</code>. Por desgracia la API de Marvel nos devuelve las URLs como <code>http:</code>. Podemos "salir del paso" con este peque√±o <em>parche</em>.</p>
</blockquote>
<h2 id="vista-acerca-de-05-puntos">Vista "Acerca de" (0,5 puntos)<a class="headerlink" href="#vista-acerca-de-05-puntos" title="Permanent link">&para;</a></h2>
<p>Esta es la segunda de las pantallas del <em>tab bar</em>. Simplemente debe consistir en una imagen est√°tica y un <em>text view</em> o un <em>label</em> con informaci√≥n sobre la aplicaci√≥n.</p>
<p>Pon la imagen y el texto en un <em>stack view</em> vertical y a√±ade estricciones de <em>autolayout</em> para que est√©n a 40 puntos de los m√°rgenes </p>
<h2 id="apendice-creacion-de-la-plantilla-de-proyecto-desde-cero">Ap√©ndice: creaci√≥n de la plantilla de proyecto desde cero<a class="headerlink" href="#apendice-creacion-de-la-plantilla-de-proyecto-desde-cero" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Esta secci√≥n est√° solo para que veas c√≥mo se ha creado la plantilla de proyecto, no es necesario que lo hagas si has usado la plantilla que est√° en moodle.</p>
</blockquote>
<p>Hasta Xcode 11 no hab√≠a ning√∫n sistema de gesti√≥n de dependencias de librer√≠as de terceros para iOS incluido en el IDE. Desde Xcode 11 tenemos el <em>Swift Package Manager</em>, pero durante todo el tiempo que no ha existido una herramienta propia de Apple, la comunidad ha tenido que "cubrir ese hueco" desarrollando gestores de paquetes para iOS. Probablemente el m√°s conocido sea<a href="http://cocoapods.org"><em>CocoaPods</em></a> que es el que vamos a usar aqu√≠.</p>
<p>Cocoapods es a la vez un repositorio de librer√≠as y un gestor de dependencias para instalar autom√°ticamente estas librer√≠as en nuestros proyectos. Hay muchas librer√≠as de terceros disponibles con este sistema, puedes buscarlas desde la p√°gina de CocoaPods.</p>
<p>Para instalar <code>cocoapods</code>, desde la terminal hacer</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Con --pre decimos que queremos instalar la √∫ltima versi√≥n, aunque sea RC</span>
sudo gem install -n /usr/local/bin cocoapods --pre
</code></pre></div>
<blockquote>
<p>Esto instala la herramienta desde un repositorio de Internet, as√≠ que  necesitar√°s conectividad...y paciencia, seg√∫n vaya la red.</p>
</blockquote>
<p>Si todo va bien se instalar√° un comando llamado <code>pod</code>. Ejec√∫talo desde la terminal para comprobar que existe y no da error. </p>
<p>Ahora debes seguir estos pasos:</p>
<ol>
<li>Crear un proyecto Xcode para la aplicaci√≥n. Ll√°malo por ejemplo <code>Marvel</code></li>
<li>Con un editor de textos cualquiera, crear un fichero llamado <code>Podfile</code> en el directorio del proyecto (el que contiene el fichero <code>.xcodeproj</code>). Este archivo debe contener la configuraci√≥n y las dependencias (o <em>pods</em>) del proyecto</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">#SUSTITUYE la versi√≥n de ios por la que quieras usar como target de tu app</span>
<span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">&#39;16.0&#39;</span>
<span class="n">use_frameworks!</span>
<span class="c1">#SUSTITUYE &#39;Marvel&#39; por el nombre de tu proyecto, si no se llama as√≠!!!</span>
<span class="n">target</span> <span class="s1">&#39;Marvel&#39;</span> <span class="k">do</span>
   <span class="n">pod</span> <span class="s1">&#39;Marvelous&#39;</span>
<span class="k">end</span>
</code></pre></div>
<ol start="5">
<li>Abre una terminal. Mu√©vete hasta el directorio donde est√° el <code>Podfile</code> y desde √©l ejecuta el comando <code>pod install</code>. Las dependencias de nuestro proyecto se bajar√°n autom√°ticamente y se crear√° en el directorio actual un <code>Marvel.xcworkspace</code></li>
<li><strong>A partir de ahora para trabajar en el proyecto siempre abriremos el fichero Marvel.xcworkspace</strong>, que es un <em>workspace</em> de Xcode (un conjunto de proyectos), no el proyecto Marvel directamente (<strong>NO ABRAS DIRECTAMENTE el <code>Marvel.xcodeproj</code></strong>).</li>
<li>Veremos que en Xcode se muestra nuestro proyecto y adem√°s un proyecto adicional llamado <code>Pods</code>, que contiene las dependencias. Este √∫ltimo no lo tocaremos, pero es necesario que est√© ah√≠ para que funcione el nuestro.</li>
</ol>
<h3 id="uso-de-marvelous">Uso de <code>Marvelous</code><a class="headerlink" href="#uso-de-marvelous" title="Permanent link">&para;</a></h3>
<blockquote>
<p>ANTES de empezar a escribir c√≥digo aseg√∫rate de hacer en Xcode un <code>Product &gt; Clean Build Folder</code>, y <code>Product &gt; Build</code> para asegurarse de que las dependencias est√°n compiladas y accesibles en nuestro c√≥digo.</p>
<p>Para poder hacer llamadas al API de Marvel necesitas un par de claves. Las puedes ver, una vez dado de alta y autentificado en Marvel, en <code>https://developer.marvel.com/account</code></p>
</blockquote>
<p>El siguiente c√≥digo ya est√° metido en la plantilla, si te la has bajado. Solo es necesario poner en marcha el proyecto para probar si sale en la consola la lista de personajes.</p>
<p>Para probar de manera sencilla la librer√≠a <code>Marvelous</code> puedes poner este <code>import</code> en el <code>ViewController</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">import</span> <span class="nc">Marvelous</span>
</code></pre></div>
<p>Y ahora copiar la siguiente funci√≥n en el <em>view controller</em>, quemuestran en la consola todos los personajes cuyo nombre comienza por una determinada cadena.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">mostrarPersonajes</span><span class="p">(</span><span class="n">comienzanPor</span> <span class="n">cadena</span> <span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">marvelAPI</span> <span class="p">=</span> <span class="n">RCMarvelAPI</span><span class="p">()</span>
        <span class="c1">//PUEDES CAMBIAR ESTO PARA PONER TUS CLAVES</span>
        <span class="n">marvelAPI</span><span class="p">.</span><span class="n">publicKey</span> <span class="p">=</span> <span class="s">&quot;a6927e7e15930110aade56ef90244f6d&quot;</span>
        <span class="n">marvelAPI</span><span class="p">.</span><span class="n">privateKey</span> <span class="p">=</span> <span class="s">&quot;487b621fc3c0d6f128b468ba86c99c508f24d357&quot;</span>
        <span class="kd">let</span> <span class="nv">filtro</span> <span class="p">=</span> <span class="n">RCCharacterFilter</span><span class="p">()</span>
        <span class="n">filtro</span><span class="p">.</span><span class="n">nameStartsWith</span> <span class="p">=</span> <span class="n">cadena</span>
        <span class="n">marvelAPI</span><span class="p">.</span><span class="n">characters</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="n">filtro</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">resultados</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
            <span class="k">if</span> <span class="kd">let</span> <span class="nv">personajes</span> <span class="p">=</span> <span class="n">resultados</span> <span class="k">as</span><span class="p">!</span> <span class="p">[</span><span class="n">RCCharacterObject</span><span class="p">]?</span> <span class="p">{</span>
                <span class="k">for</span> <span class="n">personaje</span> <span class="k">in</span> <span class="n">personajes</span> <span class="p">{</span>
                    <span class="bp">print</span><span class="p">(</span><span class="n">personaje</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Hay </span><span class="si">\(</span><span class="n">personajes</span><span class="p">.</span><span class="bp">count</span><span class="si">)</span><span class="s"> personajes&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Puedes llamar a la funci√≥n anterior desde el <code>viewDidLoad</code> del <em>view controller</em></p>
<div class="highlight"><pre><span></span><code><span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
    <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
    <span class="n">mostrarPersonajes</span><span class="p">(</span><span class="n">comienzanPor</span><span class="p">:</span> <span class="s">&quot;Spider&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Pie" >
      
        
        <a href="../../complementario/concurrencia/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Concurrencia en iOS" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Concurrencia en iOS
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>